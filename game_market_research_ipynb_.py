# -*- coding: utf-8 -*-
"""Копия блокнота "Game Market Research.ipynb"

Automatically generated by Colaboratory.

Original file is located at
    https://colab.research.google.com/drive/1Akg8iGMRXpW7-mjn7k5yVULjKsIwqLst

<div class="alert alert">
    <font size="5"><b>Исследование рынка игр</b></font>

Для планирования кампании на 2017 год для интернет-магазина компьютерных игры «Стримчик» необходимо провести анализ рынка игр. Доступны данные за период с 1980 по 2016 годы о продажах игр, оценках пользователей и экспертов, жанрах и платформах. Вся информация собрана в таблицу games и содержит следующие столбцы: 
    Name — название игры
    Platform — платформа
    Year_of_Release — год выпуска
    Genre — жанр игры
    NA_sales — продажи в Северной Америке (миллионы долларов)
    EU_sales — продажи в Европе (миллионы долларов)
    JP_sales — продажи в Японии (миллионы долларов)
    Other_sales — продажи в других странах (миллионы долларов)
    Critic_Score — оценка критиков (от 0 до 100)
    User_Score — оценка пользователей (от 0 до 10)
    Rating — рейтинг от организации ESRB (англ. Entertainment Software Rating Board). Эта ассоциация определяет рейтинг компьютерных игр и присваивает им подходящую возрастную категорию.

Данные за 2016 год могут быть неполными.
"""

import pandas as pd
import matplotlib.pyplot as plt
import seaborn as sns
import numpy as np
from scipy import stats as st

"""Прочитаем файл games.csv и сохраним его в переменной games. """

games = pd.read_csv("/datasets/games.csv")
pd.set_option('display.max_columns', 12)

"""Получим первые 10 строк таблицы."""

games.head(10)

"""Общая информация о данных таблицы.

"""

games.info()

"""Рассмотрим полученную информацию подробнее.

Всего в таблице 11 столбцов, в пяти из них тип данных - текстовый или смешанный тип, в шести - числа с плавающей точкой. Таким образом, для изучения доступны пять категориальных и шесть количественных признаков. Представлена информация о 16715 играх, количество значений в столбцах различается. Это говорит о том, что в данных есть пропущенные значения.

Можно предположить, что данные в таких столбцах, как название и жанр, случайно были пропущены при заполнении таблицы, так как любая игра должна иметь название и любой игре можно предписать определенный жанр. Достаточно большое количество пропусков есть в столбцах, содержащих информацию об оценках критиков, пользователей и рейтинге. Небольшая часть этих данных также могла быть пропущена при заполнении таблицы из-за человеческого фактора, но большое количество пропусков наводит на мысль, что часть игр просто не обладает этими характеристиками.

Подготовка данных
"""

games.columns

"""1) Приведем названия столбцов к нижнему регистру."""

games = games.rename(columns = {'Name': 'name', 'Platform': 'platform', 'Year_of_Release': 'year_of_release', 'Genre': 'genre', 'NA_sales': 'na_sales', 'EU_sales':'eu_sales', 'JP_sales': 'jp_sales', 'Other_sales':'other_sales', 'Critic_Score': 'critic_score', 'User_Score': 'user_score', 'Rating':'rating'})
games.columns

"""2) Преобразуем данные в нужные типы. """

games.isna().sum()

games['user_score'] = pd.to_numeric(games['user_score'], errors = 'coerce')

"""Преобразуем данные об оценке пользователей в числовой тип, чтобы иметь возможность совершать с этими данными математические действия. Так как изначально у этого столбца тип object, это значит, в столбце есть нечисловые значения или пропуски. Присвоим параметру errors значение coerce, чтобы заменить некорректные значения на NaN. До и после операции количество NaN в столбце не изменилось, значит, некорректных значений не было."""

games.isna().sum()

games.head(10)

"""В столбце year_of_release поменяем данные на целочисленный тип int64."""

games['year_of_release'] = games['year_of_release'].astype('Int64')

games.head(10)

"""3) Обработаем пропуски и дубликаты. Проверим их наличие."""

games.duplicated().sum()

"""Дубликатов нет."""

games.isnull().sum()

"""Пустые значения свидетельствуют о том, что для некоторых игр доступна не вся информация.

Во-первых, в двух наблюдениях нет названия игр, еще в двух - жанра. Скорее всего, эти пропуски носят не системный характер и связаны с человеческим фактором - при заполнении данных эти показатели могли пропустить. Так как их доля незначительна и не представляется возможным заменить пропуски на данные, эти наблюдения можно удалить.
"""

games.dropna(subset = ['name'], inplace = True)
games.dropna(subset = ['genre'], inplace = True)
games.info()

"""Следущий столбец с пропусками - год релиза. Относительно общего числа наблюдений их немного, они носят не системный характер. Частично эти пропуски можно заполнить, используя информацию из столбца с названием игры, так как во многих названиях есть указание года. Также в некоторых случаях, если игра представлена на нескольких платформах, есть информация о годе релиза для какой-то одной из платформ. Соответсвенно, эту информацию можно использовать, чтобы заполнить пропуски для остальных платформ. Это позволит получить данные более, чем о половине игр с пропущенным годом выхода. При необходимости оставшиеся данные можно восстановить вручную, находя информацию о дате релиза игры в открытых источниках, тк количество таких наблюдений сравнительно невелико. """

for row in games[games['year_of_release'].isnull() == True].index:  
    games['year_of_release'][row] = games.loc[games['name'] == games['name'][row], 'year_of_release'].max()
games.isnull().sum()

"""Почти у половины наблюдений отсутствуют данные о рейтинге критиков и пользователей ( 51 % и 54% соответственно). Большое количество пропусков указывает на то, что их появление не случайно и носит системный характер. В большинстве случаев, скорее всего, для этих игр не проводилась оценка. Поэтому нельзя с точностью сказать, является ли отсутствие рейтинга ошибочным пропуском или этой информации не может быть в принципе. В момент анализа этих параметров можно будет изучить данные как есть и сравнить с ситуацией, когда пропуски заменены на среднее (так как здесь не может появиться предельно больших чисел, сильно искажающих общую картину, и все варианты ограничены диапазоном от 0 до 100 и от 0 до 10, нет необходимости использовать медиану, и пропуски можно заменить на среднее)."""

#games['critic_score'] = games['critic_score'].fillna(games['critic_score'].mean())
#games['user_score'] = games['user_score'].fillna(games['user_score'].mean())

"""В столбцах с рейтингом есть аббревиатуру 'tbd' - 'to be determined'. Это означает, что рейтинг еще не определен. Можно отметить, что зачастую рейтинга нет у игр, для которых продажи есть только в японском сегменте рынка. Возможно, что это игры для внутреннего рынка и, соответственно, для них рейтинг не выставляется, но предположение следует проверить, если это возможно, у создателей сводной таблицы. Также рейтинга может не быть у игр, созданных до его возникновения. Пока же можно заменить пустые значения на NR - no rating, и рассматривать, помимо самих рейтингов, еще две категории - рейтинг не определен и нет рейтинга."""

games['rating'] = games['rating'].fillna('NR')
games.head(10)

games.isnull().sum()

"""4) Посчитаем суммарные продажи во всех регионах и запишем их в отдельный столбец"""

games['all_sales'] = games['na_sales']+games['eu_sales']+games['eu_sales']+games['eu_sales']+games['other_sales'] 
games.head(10)

"""Исследовательский анализ данных

1) Посмотрим, сколько игр выпускалось в разные годы и оценим, важны ли данные за все периоды. Для этого группируем данные по году и вызовом метода nunique() подсчитаем количество уникальных игр для каждого года (так как многие игры указаны для нескольких платформ одновременно).
"""

count_on_year = games.groupby('year_of_release')['name'].nunique()
count_on_year

plt.figure(figsize=(10,5))
sns.lineplot(data=count_on_year)
plt.title('Количество выпущенных игр за период 1980-2016 гг.')
plt.xlabel('Год выпуска игры')
plt.ylabel('Количество выпущенных игр')
plt.legend('')

"""Видно, что до 1994 года количество выпускаемых игр значительно ниже. В 1994 году появились новые жанры, образовались новые франшизы и компании, а также Interactive Digital Software Association, которая учреждает возрастной рейтинг для видео игр Entertainment Software Rating Board (ESRB). Пик продаж игр пришелся на 2008-2009 год, потом началось снижение, что можно объяснить массовым распространением мобильных телефонов и планшетов и популярностью мобильных игр. Согласно информации из сети, массовое развитие мобильного гейминга началось еще в 2009-2011 годах, когда AppStore и PlayMarket начали активно заполнять такие игры, как: Angry Birds, Fruit Ninja и прочие.

2) Посмотрим, как менялись продажи по платформам.
"""

platform_sales = games.pivot_table(index='platform', values='all_sales', aggfunc='sum').sort_values(by='all_sales', ascending=False)
platform_sales

plt.figure(figsize=(20,10))
sns.barplot(x=platform_sales.index,y=platform_sales['all_sales'])
plt.title('Продажи игр для разных платформ за период 1980-2016 гг')
plt.xlabel('Название платформы')
plt.ylabel('Количество продаж')

"""В числе первых шести приставок с количеством игр больше тысячи - игровые приставки линейки PlayStation компании Sony( PlayStation, PlayStation 2 и PlayStation 3). Исторически большое количество хитовых игр сделало эту приставку очень популярной, что позволило PlayStation  удержать лидерство на рынке игровых консолей. Следующие по популярности - консоли от Nintendo DS и Wii, а также игровая приставка компании Microsoft Xbox 360.

Выберем платформы с наибольшими суммарными продажами и построим распределение по годам. Возьмем консоли с продажами больше 1000. Это PS2, PS3, X360, Wii, PS, DS.
"""

top_platforms = games.pivot_table(index='platform', values='all_sales', aggfunc='sum').sort_values(by='all_sales', ascending=False).head(6)
top_platforms

def sale_on_year_for_platform(platform):
    all_sales_on_platform =games[(games['platform'] == platform)].pivot_table(index='year_of_release', values='all_sales', aggfunc='sum').sort_values('year_of_release', ascending=False)
    return all_sales_on_platform

sale_on_year_for_platform('PS2')

plt.figure(figsize=(10,5))
sns.lineplot(data=sale_on_year_for_platform('PS2'))
plt.title('Количество проданных игр для платформы PS2')
plt.xlabel('Год выпуска игры')
plt.ylabel('Количество проданных игр')
plt.legend('')

sale_on_year_for_platform('PS3')

plt.figure(figsize=(10,5))
sns.lineplot(data=sale_on_year_for_platform('PS3'))
plt.title('Количество проданных игр для платформы PS3')
plt.xlabel('Год выпуска игры')
plt.ylabel('Количество проданных игр')
plt.legend('')

sale_on_year_for_platform('X360')

plt.figure(figsize=(10,5))
sns.lineplot(data=sale_on_year_for_platform('X360'))
plt.title('Количество проданных игр для платформы X360')
plt.xlabel('Год выпуска игры')
plt.ylabel('Количество проданных игр')
plt.legend('')

sale_on_year_for_platform('Wii')

plt.figure(figsize=(10,5))
sns.lineplot(data=sale_on_year_for_platform('Wii'))
plt.title('Количество проданных игр для платформы Wii')
plt.xlabel('Год выпуска игры')
plt.ylabel('Количество проданных игр')
plt.legend('')

sale_on_year_for_platform('PS')

plt.figure(figsize=(10,5))
sns.lineplot(data=sale_on_year_for_platform('PS'))
plt.title('Количество проданных игр для платформы PS')
plt.xlabel('Год выпуска игры')
plt.ylabel('Количество проданных игр')
plt.legend('')

sale_on_year_for_platform('DS')

"""Избавимся от 1985 года."""

sale_on_year_for_platform_DS = games[(games['platform'] == 'DS') & (games['year_of_release'] > 2003)].pivot_table(index='year_of_release', values='all_sales', aggfunc='sum').sort_values('year_of_release', ascending=False)
sale_on_year_for_platform_DS

plt.figure(figsize=(10,5))
sns.lineplot(data=sale_on_year_for_platform_DS)
plt.title('Количество проданных игр для платформы DS')
plt.xlabel('Год выпуска игры')
plt.ylabel('Количество проданных игр')
plt.legend('')

"""Так как три консоли - это приставки линейки PS разного поколения, можно наблюдать, как с появлением очередной модели спрос на предыдущие снижался. Игры для PS продавались 10 лет с 1994 по 2003, максимальные продажи пришлись на промежуток с 1996-2000 с пиком в 1998 году, после 2000 резко упали, так как появилась приставка Playstation2. Игры для PS2 продавались 11 лет с 2000 по 2011 с максимальными продажами в период 2001 по 2006, затем на рынке появились игры для PS3 и продержались там 12 лет с 2005 по 2016, соответственно, продажи для PS2 пошли на спад. Больше всего игр для PS3 было продано с 2008 по 2013 с пиком в 2010-2011. А в 2013 уже появилась приставка PS4, соответственно, можно ожидать популярность игр для нее в 2016-2018 годах. Игры для платформы Х360 развивались 12 лет, наибольший спрос на них пришелся на 2008-2013 года с пиком в 2010-2011, игры для консоли Nintendo Wii продавались с 2006 по 2016 с максимум в промежутке от 2006 по 2010 и пиком в 2009. Карманная консоль Nintendo DS  была разработана в 2004 (появление в таблице строки с 85 - какая-то ошибка) и игры для нее продавались до 2013, популярность этих игр резко возросла почти сразу после выхода в 2005 и продержалась пять лет до 2009, больше всего продаж было сделано в 2007-2008 годы. Для всех платформ наблюдается примерно одинаковое развитие - время существования определенной модели 10-12 лет (в случае с PS - это естественная смена моделей на более современные версии), на пике популярности держится около 4 лет. Из популярных раньше платформ до 2016 продержались Wii, X360 и PS3, продажи для более ранних версий этих приставок сейчас на нуле.

Рассчитаем продолжительность существования отобранных платформ.
"""

print('Срок существования платформы PS2', sale_on_year_for_platform('PS2').shape[0])
print('Срок существования платформы PS3', sale_on_year_for_platform('PS3').shape[0])
print('Срок существования платформы X360', sale_on_year_for_platform('X360').shape[0])
print('Срок существования платформы Wii', sale_on_year_for_platform('Wii').shape[0])
print('Срок существования платформы PS', sale_on_year_for_platform('PS').shape[0])
print('Срок существования платформы DS', sale_on_year_for_platform('DS').shape[0])

"""Срок существования платформ примерно одинаковый, судя по графикам, рост и снижение продаж тоже происходит примерно одинаково. Отличаются продажи игр для таких платформ, как Wii и DS. Продажи для Wii начались очень хорошо и быстро вышли на пик, но резко упали после 2009 года. В продажах игр для DS в 2006 наблюдался небольшой провал. Успех на старте продаж у игр для Wii легко объясним - для охвата наибольшей аудитории на консоль была поставлена цена на порядок ниже, чем у Xbox и PS3. Таким образом приставка Wii была нацелена на казуальную аудиторию. Возможно, в этом же и причина такого резкого спада продаж игр для нее - казуалы очень не постоянные игроки, а для геймеров, увлеченных компьютерными играми, игры для данной приставки могли не понравиться из-за слабой графики. Также можно предположить, что спад продаж вызвал выход в 2012 консоли следующего поколения Wii U и появления игр для нее. Для Ds провал в 2006, возможно, связан с появление в этом году PlayStation 3 и Nintendo Wii, что могло оттянуть внимание пользователей. 
Несмотря на все различия, в анализе стоит учитывать все платформы, так как каких-то аномальных значений в продолжительности существования нет, те выбросов, вызванных каким-то случайными ошибками нет. Можно предположить, что после 2016 года будет наблюдаться такая же картина, однако, нельзя отрицать возможность выбросов естсетсвенного характера - например, могут быть введены санкции против компании, производящей игры, и ей придется прекратить выпуск игр на определенный рынок, что сократит продолжительность. Но в этом случае выброс не будет являться результатом ошибки и даст новое понимание рынка игр, поэтому его также нужно будет учитывать.

3) Необходимо определить, данные за какой период нужно взять, чтобы исключить значимое искажение распределения по платформам в 2016 году. Для всех платформ общей точкой вхождения является 2006 год (самая рання дата для Wii). Информацию для PS можно дальше не рассматривать, так как продажи игр для нее закончились еще в 2003.

4) Таким образом, в дальнейшем будем рассматривать данные для платформ PS2, PS3, X360, Wii, DS в промежутке от 2006 по 2016 годы.
"""

top_platforms = games[ (games['platform'].isin(['PS2', 'PS3', 'X360', 'Wii', 'DS']) & (games['year_of_release'] >2005))]
top_platforms.head(10)

"""Так как к 2017 году индустрия компьютерных игр находится на спаде, информация о периоде расцвета исказит результаты анализа, сократим период до промежутка  2010-2016. Часть приставок, которые обозначили выше как наиболее популярные, уже не существуют к этому времени, поэтому не будем первоначально ограничиваться списком PS2, PS3, X360, Wii, DS и проверим, какие приставки остались и какие из новых лидеров появились в последние пять лет.

За последние пять лет в лидерах оставались PS3 и X360, появилась портативная приставка следующего поколения от Nintendo 3DS, поступившая в продажу в 2011 году. Также появились игры для PC. Для дальнейшего анализа отфильтруем таблицу по пяти самым популярным платформам.
"""

top_platforms = games[(games['platform'].isin(['PS3', 'X360', 'PS4', 'Wii', '3DS']) & (games['year_of_release'] >2009))]
top_platforms.head(10)

"""5) Нужно определить, какие платформы лидируют по продажам, растут или падают, и выбрать несколько потенциально прибыльных платформ. Остановимся на последнем годе."""

games_in_2016 = games[(games['year_of_release'] == 2016)]
best_in_2016 = games_in_2016.pivot_table(index=['platform'], values='all_sales', aggfunc='sum').reset_index().sort_values(by='all_sales', ascending=False)
best_in_2016

"""Самыми популярными в 2016 году стали игры для PS4 и XOne. Однако, судя по уровню продаж игр для платформ в целом, данная отрасль не перспективна из-за технического и морального устаревания консолей и приставок, и популярности мобильных игр. """

plt.figure(figsize=(20,10))
sns.barplot(x=best_in_2016['platform'],y=best_in_2016['all_sales'])
plt.title('Продажи игр для разных платформ за 2016 год')
plt.xlabel('Название платформы')
plt.ylabel('Количество продаж')

"""6) Построим график «ящик с усами» по глобальным продажам каждой игры и разбивкой по платформам. Изучим, велика ли разница в продажах и в средних продажах на разных платформах."""

plt.figure(figsize=(20,20))
sns.boxplot(data=top_platforms, x='platform', y='all_sales')
plt.show()

"""Избавимся от выбросов."""

top_platforms = top_platforms[top_platforms['all_sales']<2]

plt.figure(figsize=(20,20))
sns.boxplot(data=top_platforms, x='platform', y='all_sales')
plt.show()

"""Продажи по всем платформам протекают по разному. Больше всего продаж у X360, затем у PS3, на третьем месте PS4. Медиана для Wii и PS3 примерно одинаковы, для другие же платформ они разительно отличаются."""

top_platforms['all_sales'].describe()

"""Судя по графику, наиболее гармонично выглядят продажи игр для X360 - половина всех игр для нее лучше продается, чем для других платформ. Стоимость игр разных платформ примерно одинакова, сама же приставка X360 дешевле аналогичной приставки от Sony, что может быть одной из причин того, что эти игры хорошо продаются - сама приставка более массово распространена.  Для 3DS наоборот, почти у всех игр продажы низкие, те почти все игры достаточно не популярны. Данные об играх для платфоры PS3 имеют самую высокую степень разброса среднеквадратичного отклонения и дисперсии, следовательно, уровень продаж для разных игр этой платфоры сильно различается. Таким образом, стабильнее всего продаются игры для Х360, возможно из-за того, что большинство игр одинаково популярны. Меньше всего продаж у игр для японсокй приставки 3DS, можно предположить, что большинство игр для нее остается на внутреннем японском рынке, что снижает общие продажи. Продажи игр для PS3 наиболее неоднородны - значит, среди игр много как очень популярных, так и оставшихся незамеченными.

7) Посмотрим, как влияют на продажи внутри одной популярной платформы отзывы пользователей и критиков. Для этого построим диаграмму рассеяния и посчитаем корреляцию между отзывами и продажами. По общему числу продаж лидирует PS2.

Для начала оценим влияние отзывов пользователей.
"""

games_for_ps2 = games[games['platform']=='PS2']
plt.figure(figsize=(20,10))
sns.scatterplot(x='user_score', y='all_sales', data=games_for_ps2)

"""Избавимся от выбросов."""

games_for_ps2 = games[(games['platform']=='PS2') & (games['all_sales']<10)]
plt.figure(figsize=(20,10))
sns.scatterplot(x='user_score', y='all_sales', data=games_for_ps2)

"""Посчитаем корреляцию между отзывами и продажами"""

games_for_ps2['user_score'].corr(games_for_ps2['all_sales'])

"""Корреляция слабая положительная, то есть отзывы пользователей очень незначительно повлияют на решение других пользователей о покупке.

Теперь рассмотрим влияние отзывов критиков.
"""

plt.figure(figsize=(20,10))
sns.scatterplot(x='critic_score', y='all_sales', data=games_for_ps2)

games_for_ps2['critic_score'].corr(games_for_ps2['all_sales'])

"""Корреляция умеренная положительная, то есть отзывы критиков у покупателей вызывают больше доверия, чем отзывы других пользователей, и больше влияют на решение совершить покупку.

Соотнесем эти выводы с продажами игр на других платформах.
"""

games_for_ps3 = games[(games['platform']=='PS3') & (games['all_sales']<10)]
print('Коэффициент корреляция между отзывами пользователей и продажами для PS2', games_for_ps3['user_score'].corr(games_for_ps3['all_sales']))
print('Коэффициент корреляция между отзывами критиков и продажами для PS2', games_for_ps3['critic_score'].corr(games_for_ps3['all_sales']))

games_for_X360 = games[(games['platform']=='X360') & (games['all_sales']<10)]
print('Коэффициент корреляция между отзывами пользователей и продажами для X360', games_for_X360['user_score'].corr(games_for_X360['all_sales']))
print('Коэффициент корреляция между отзывами критиков и продажами для X360', games_for_X360['critic_score'].corr(games_for_X360['all_sales']))

games_for_DS = games[(games['platform']=='DS') & (games['all_sales']<10)]
print('Коэффициент корреляция между отзывами пользователей и продажами для DS', games_for_DS['user_score'].corr(games_for_DS['all_sales']))
print('Коэффициент корреляция между отзывами критиков и продажами для DS', games_for_DS['critic_score'].corr(games_for_DS['all_sales']))

games_for_Wii = games[(games['platform']=='Wii') & (games['all_sales']<10)]
print('Коэффициент корреляция между отзывами пользователей и продажами для Wii', games_for_Wii['user_score'].corr(games_for_Wii['all_sales']))
print('Коэффициент корреляция между отзывами критиков и продажами для Wii', games_for_Wii['critic_score'].corr(games_for_Wii['all_sales']))

"""Для PS3 и X360 наблюдается такая же картина, как и для PS2 - слабое влияние отзывов пользователей и умеренная корреляция с отзывами критиков. Для DS и Wii оба уровня корреляции оказались незначительными, причем влияние критиков также выше, чем влияние отзывов пользователей.

Оценки критиков для потенциальных покупателей игры это самый простой способ сформировать приблизительное мнение о продукте, не играя самому. Зачастую критики получают копию игры до начала официальных продаж, поэтому в первое время есть только эти отзывы, отзывы покупателей появляются, естественно, позже. Также, в силу определенного профессионализма, критик может более адекватно оценить какие-то параметры и характеристики игры в плане графики, геймплея и тд. Нужно отметить, что при этом отзыв критика может быть заказан разработчиками игры, что снижает его объективность. Пользовательский рейтинг более субъективен и непредсказуем. Но в общем, люди больше доверяют отзывам профессиональных критиков.

8) Посмотрим на общее распределение игр по жанрам и определим самые прибыльные жанры.
"""

count_genre = games.groupby('genre')['name'].nunique()
count_genre.sort_values(ascending=False)

"""В целом в базе данных больше всего игр таких жанров, как action, sports и misc, так что можно ожидать, что и по продажам они будут лидировать."""

games_by_genre = games.pivot_table(index='genre', values='all_sales', aggfunc='sum').sort_values(by='all_sales', ascending=False)
games_by_genre = games_by_genre.reset_index().rename_axis(None, axis=1)
games_by_genre

"""Самый популярный жанр - action, затем идут sport и shooter. Racing, misc, platform имеют примерно одинаковую популярность, а затем интерес пользователей к играм остальных жанров резко падает. Самые низкие продажи у игр жанра strategy. При том, что action, sports и misc самые популярные жанры и у разработчиков, игр в жанре shooter создано почти в полтора раза меньше, но продажи почти такие же, как у sports.

Составим портрет пользователя каждого региона

1) Определим для пользователя каждого региона (NA, EU, JP) самые популярные платформы (топ-5) и самые популярные жанры (топ-5). Оценим, влияет ли рейтинг ESRB на продажи в отдельном регионе?

Для региона NA.
"""

NA_sales = games.pivot_table(index='platform', values='na_sales', aggfunc='sum').sort_values(by='na_sales', ascending=False)
NA_sales.head(5)

plt.figure(figsize=(20,10))
sns.barplot(x=NA_sales.index,y=NA_sales['na_sales'])
plt.title('Продажи игр для разных платформ в Северной Америке')
plt.xlabel('Название платформы')
plt.ylabel('Количество продаж')

NA_genre = games.pivot_table(index='genre', values='na_sales', aggfunc='sum').sort_values(by='na_sales', ascending=False)
NA_genre.head(5)

plt.figure(figsize=(20,10))
sns.barplot(x=NA_genre.index,y=NA_genre['na_sales'])
plt.title('Продажи игр разных жанров в Северной Америке')
plt.xlabel('Название жанра')
plt.ylabel('Количество продаж')

NA_rating = games.pivot_table(index='rating', values='na_sales', aggfunc='sum').sort_values(by='na_sales', ascending=False)
NA_rating.head(5)

plt.figure(figsize=(20,10))
sns.barplot(x=NA_rating.index,y=NA_rating['na_sales'])
plt.title('Продажи игр разных рейтингов в Северной Америке')
plt.xlabel('Рейтинг')
plt.ylabel('Количество продаж')

"""Для региона Северной Америки наблюдается примерно такая же картина, как и для общих продаж - самые популярные игры для таких платформ, как X360, PS2, Wii, PS3 и DS. Самые популярные жанры - action, sports, shooter, platform, misc. Лучше всего продавались игры с рейтингом Е (Everyone, для всех), а также с рейтингом T (Teen, Подросткам 13—19) и M(Mature, от 17 лет).

Для региона EU.
"""

EU_sales = games.pivot_table(index='platform', values='eu_sales', aggfunc='sum').sort_values(by='eu_sales', ascending=False)
EU_sales.head(5)

plt.figure(figsize=(20,10))
sns.barplot(x=EU_sales.index,y=EU_sales['eu_sales'])
plt.title('Продажи игр для разных платформ в Европе')
plt.xlabel('Название платформы')
plt.ylabel('Количество продаж')

EU_genre = games.pivot_table(index='genre', values='eu_sales', aggfunc='sum').sort_values(by='eu_sales', ascending=False)
EU_genre.head(5)

plt.figure(figsize=(20,10))
sns.barplot(x=EU_genre.index,y=EU_genre['eu_sales'])
plt.title('Продажи игр разных жанров в Европе')
plt.xlabel('Название жанра')
plt.ylabel('Количество продаж')

EU_rating = games.pivot_table(index='rating', values='eu_sales', aggfunc='sum').sort_values(by='eu_sales', ascending=False)
EU_rating.head(5)

plt.figure(figsize=(20,10))
sns.barplot(x=EU_rating.index,y=EU_rating['eu_sales'])
plt.title('Продажи игр разных рейтингов в Европе')
plt.xlabel('Рейтинг')
plt.ylabel('Количество продаж')

"""Европейский сегмент игр имеет следущие особенности: cамые популярные платформы это PS2, PS3, X360, Wii и PS. Среди популярных жанров выделяются почти все те же, что и для Серевной Америки. Самые популярные жанры - action, sports, shooter, racing, misc. Наиболее востребованы игры рейтинга Е (Everyone, для всех), M(Mature, от 17 лет), а также с рейтингом T (Teen, Подросткам 13—19). Также, как и для Северной Америки, игр рейтинга E  почти в два раза больше, а игр рейтинга M и Т примерно поровну. Что естественно, так как в игра для всех, помимо детей младшего возраста и старше 10 лет, могут играть подростки 13-19 лет и старше 17.

Для региона JP.
"""

JP_sales = games.pivot_table(index='platform', values='jp_sales', aggfunc='sum').sort_values(by='jp_sales', ascending=False)
JP_sales.head(5)

plt.figure(figsize=(20,10))
sns.barplot(x=JP_sales.index,y=JP_sales['jp_sales'])
plt.title('Продажи игр для разных платформ в Японии')
plt.xlabel('Название платформы')
plt.ylabel('Количество продаж')

JP_genre = games.pivot_table(index='genre', values='jp_sales', aggfunc='sum').sort_values(by='jp_sales', ascending=False)
JP_genre.head(5)

plt.figure(figsize=(20,10))
sns.barplot(x=JP_genre.index,y=JP_genre['jp_sales'])
plt.title('Продажи игр разных жанров в Японии')
plt.xlabel('Название жанра')
plt.ylabel('Количество продаж')

JP_rating = games.pivot_table(index='rating', values='jp_sales', aggfunc='sum').sort_values(by='jp_sales', ascending=False)
JP_rating.head(5)

plt.figure(figsize=(20,10))
sns.barplot(x=JP_rating.index,y=JP_rating['jp_sales'])
plt.title('Продажи игр разных рейтингов в Японии')
plt.xlabel('Рейтинг')
plt.ylabel('Количество продаж')

"""В таблице представлена информация о рейтинге  ESRB - Entertainment Software Rating Board. Возрастными рейтингами для консольных игр в Японии занимается CERO – некоммерческая организация, основанная в июле 2002-го. До 2006 года ее система состояла из четырех категорий – А («для всех возрастов»), B («старше 12»), С («старше 15») и Z («от 18 и выше»). Скорее всего, рейтинг ESRB есть только у тех игр, которые выпускались Японией для внешнего рынка, остальные игры оцениваются по CERO.

Для Японии предпочтения пользователей отличаются от предпочтений в Америке и Европе. Самые популярные игровые платформы - DS, PS, PS2, SNES, 3DS. Здесь заметны региональные особенности. SNES - приставка от японской компании Nintendo, которая в свое время была лидером продаж в Японии. 3DS - портативная игровая система производства того же Nintendo. Топ 5 жанров - это role-playing, action, sports, platform, misc. Среди популярных жанров впервые появился жанр role-playing. Стоит отметить, что даже существует отдельное понятие японская ролевая игра, поджанр, выделяемый среди компьютерных ролевых игр. Лучше всего продавались игры с  рейтингом Е (Everyone, для всех), T (Teen, Подросткам 13—19) и M(Mature, от 17 лет). Причем для Японии, в отличие от других регионов, количество игр для тинейджеров ближе к количеству игр для всех, а количество для более страшей возрастной категории значительно ниже.

Игры, созданные в Японии, как правило отличаются от западных игр. И дело не только в культурных особенностях их создателей, но и в самом подходе к разработке. Японские игры зачастую называют безумными из-за использования непривычных для западного геймера нарративных и дизайнерских приёмов. Это происходит от того, что, например, создатели игр росли под влиянием японской анимации и манги, что сделало их видение особенным (это также справедливо и для пользователей игр).

В целом, влияние рейтинга на продажи в разных регионах примерно одинаковое. Можно предположить, что средний пользователь игр в Японии младше, чем пользователь в Европе или Северной Америке. Также в топе игр для Северной Америке и Японии есть заметная группа игр без рейтинга, в то время как в выборке по Европе такой группы не появилось.

Исследование статистических показателей

1) Оценим, как изменяется пользовательский рейтинг и рейтинг критиков в различных жанрах. Посчитаем среднее количество, дисперсию и стандартное отклонение. Остановимся на пятерке самых популярных -  action, sport, shooter, Racing и misc.

Рассмотрим пользовательский рейтинг.
"""

top_5_genre = ['Action', 'Sports', 'Shooter', 'Racing', 'Misc']
for genre in top_5_genre:
    print('Среднее количество',genre,':',  games[games['genre']==genre]['user_score'].mean())
    print('Дисперсия', genre,':', np.var(games[games['genre']==genre]['user_score']))
    print('Стандартное отклонение', genre,':', np.std(games[games['genre']==genre]['user_score']))
    print('\n')

user_score_for_genre =pd.DataFrame({'genre':['Action', 'Sports', 'Shooter', 'Racing', 'Misc'],
        'Среднее': [7.0540, 6.9611, 7.0418, 7.0361, 6.8193],
        'Дисперсия': [2.0306, 2.5941, 2.3020, 2.3879, 2.3883],
        'Стандартное отклонение': [1.4250, 1.6106, 1.5172, 1.5453, 1.5454]})              
user_score_for_genre

"""Cтатистические показатели для всех жанров в целом похожи. В среднем, пользователи оценивают игры примерно одинаково, выделяются игры жанра misc с наименьшим пользовательским рейтингом. Игры жанра action имеют наименьшее стандартное отклонение, значит, оценки пользователей ближе к среднему показателю, чем для других жанров. Максимальные дисперсия и стандартное отклонение у жанра sports, что свидетельствует о том, что оценки этих игр наиболее неоднородны.

Построим гистограммы, чтобы оценить, как изменяется пользовательский рейтинг в различных жанра.
"""

action_with_score = games[(games['genre']=='Action')]
plt.hist(action_with_score['user_score'], bins=150)
plt.title('Оценка пользователей игр жанра Action')
plt.ylabel('Количество игр')
plt.xlabel('Оценка пользователей')
plt.show()

#проверим, адекватно ли отобразились данные
print(action_with_score['user_score'].value_counts())

sports_with_score = games[(games['genre']=='Sports')]
plt.hist(sports_with_score['user_score'], bins=150)
plt.title('Оценка пользователей игр жанра Sports')
plt.ylabel('Количество игр')
plt.xlabel('Оценка пользователей')
plt.show()

shooter_with_score = games[(games['genre']=='Shooter')]
plt.hist(shooter_with_score['user_score'], bins=150)
plt.title('Оценка пользователей игр жанра Shooter')
plt.ylabel('Количество игр')
plt.xlabel('Оценка пользователей')
plt.show()

racing_with_score = games[(games['genre']=='Racing')]
plt.hist(racing_with_score['user_score'], bins=150)
plt.title('Оценка пользователей игр жанра Racing')
plt.ylabel('Количество игр')
plt.xlabel('Оценка пользователей')
plt.show()

misc_with_score = games[(games['genre']=='Misc')]
plt.hist(misc_with_score['user_score'], bins=150)
plt.title('Оценка пользователей игр жанра Misc')
plt.ylabel('Количество игр')
plt.xlabel('Оценка пользователей')
plt.show()

"""Рассмотрим рейтинг критиков."""

for genre in top_5_genre:
    print('Среднее количество',genre,':',  games[games['genre']==genre]['critic_score'].mean())
    print('Дисперсия', genre,':', np.var(games[games['genre']==genre]['critic_score']))
    print('Стандартное отклонение', genre,':', np.std(games[games['genre']==genre]['critic_score']))
    print('\n')

critic_score_for_genre =pd.DataFrame({'genre':['Action', 'Sports', 'Shooter', 'Racing', 'Misc'],
        'Среднее': [66.6291, 71.9681, 70.1811, 67.9636, 66.6195],
        'Дисперсия': [201.7285, 192.4495, 211.5529,  202.73856, 199.9144],
        'Стандартное отклонение': [14.2031, 13.8726, 14.5448, 14.2386, 14.1391]})              
critic_score_for_genre

"""Построим гистограммы, чтобы оценить, как изменяется рейтинг критиков в различных жанра."""

plt.hist(action_with_score['critic_score'], bins=150)
plt.title('Рейтинг критиков игр жанра Action')
plt.ylabel('Количество игр')
plt.xlabel('Оценка пользователей')
plt.show()

# проверим, адекватно ли отобразились данные
print(action_with_score['critic_score'].value_counts())

sports_with_score = games[(games['genre']=='Sports')]
plt.hist(sports_with_score['critic_score'], bins=150)
plt.title('Рейтинг критиков игр жанра Sports')
plt.ylabel('Количество игр')
plt.xlabel('Оценка пользователей')
plt.show()

shooter_with_score = games[(games['genre']=='Shooter')]
plt.hist(shooter_with_score['critic_score'], bins=150)
plt.title('Рейтинг критиков игр жанра Shooter')
plt.ylabel('Количество игр')
plt.xlabel('Оценка пользователей')
plt.show()

racing_with_score = games[(games['genre']=='Racing')]
plt.hist(racing_with_score['critic_score'], bins=150)
plt.title('Рейтинг критиков игр жанра Racing')
plt.ylabel('Количество игр')
plt.xlabel('Оценка пользователей')
plt.show()

misc_with_score = games[(games['genre']=='Misc')]
plt.hist(misc_with_score['critic_score'], bins=150)
plt.title('Рейтинг критиков игр жанра Misc')
plt.ylabel('Количество игр')
plt.xlabel('Оценка пользователей')
plt.show()

"""Cтатистические показатели оценки критиков отличаются больше. Наименьший рейтинг у жанров misc и action, выше всего критики оценивают sports. Меньше всего стандартное отклонение и дисперсия у жанра spotrs, значит в оценке этого жанра критики наиболее единодушны. Для жанра shooter же характерен максимальный разброс оценок.

Проверим гипотезы

1) Дано утверждение - средние пользовательские рейтинги платформ Xbox One и PC одинаковые. Если это утверждение берется за нулевую гипотезу, то противоположная ей ситуация - рейтинги разные, соответственно формулируем гипотезы:
Но: средние пользовательские рейтинги платформ Xbox One и PC одинаковые.
Н1: средние пользовательские рейтинги платформ Xbox One и PC разные.

Посчитаем средний пользовательский рейтинг для платформ X360.
"""

xbox = games[(games['platform']=='X360')]['user_score'].dropna()
print('Cредний пользовательский рейтинг для платформ X360', xbox.mean())

"""Посчитаем средний пользовательский рейтинг для платформ PC."""

pc = games[(games['platform']== 'PC')]['user_score'].dropna()
print('Cредний пользовательский рейтинг для платформ PC', pc.mean())

variance_estimate_xbox = np.var(xbox, ddof=1)
print('Дисперсия пользовательского рейтинга для платформ X360', variance_estimate_xbox)

variance_estimate_pc = np.var(pc, ddof=1)
print('Дисперсия пользовательского рейтинга для платформ PC', variance_estimate_pc)

"""Чтобы проверить гипотезу о равенстве среднего двух совокупностей по взятым из них выборкам, применим метод scipy.stats.ttest_ind. Дисперсии совокупностей не равны, поэтому параметр equal_var указываем equal_var=False.  Критический уровень статистической значимости примем за 0,01, так как наша выборка достаточно объемна и следует понизить уровень значимости."""

alpha = .01 
results = st.ttest_ind(xbox, pc, equal_var=False)
print('p-значение: ', results.pvalue)
if (results.pvalue  < alpha):
    print("Отвергаем нулевую гипотезу")
else:
    print("Не получилось отвергнуть нулевую гипотезу")

"""Полученное значение p-value говорит о том, что средние пользовательские рейтинги для разных платформ и неодинаковы и это различие нельзя считать случайным с вероятность 0,1 %.

2) Дано утверждение - средние пользовательские рейтинги жанров Action (англ. «действие») и Sports (англ. «виды спорта») разные. Если это утверждение берется за нулевую гипотезу, то противоположная ей ситуация - рейтинги одинаковые, соответственно формулируем гипотезы:
Но: средние пользовательские рейтинги жанров Action и Sports разные.
Н1: средние пользовательские рейтинги жанров Action и Sports одинаковые.

Посчитаем средний пользовательский рейтинг для жанра Action.
"""

genre_action = games[(games['genre']=='Action')]['user_score'].dropna()
genre_action.mean()

"""Посчитаем средний пользовательский рейтинг для жанра Sports."""

genre_sports = games[(games['genre']=='Sports')]['user_score'].dropna()
genre_sports.mean()

variance_estimate_action = np.var(genre_action, ddof=1)
print('Дисперсия пользовательского рейтинга для жанра Action', variance_estimate_action)

variance_estimate_sports = np.var(genre_sports, ddof=1)
print('Дисперсия пользовательского рейтинга для жанра Sports', variance_estimate_sports)

"""Чтобы проверить гипотезу о равенстве среднего двух совокупностей по взятым из них выборкам, применим метод scipy.stats.ttest_ind.Дисперсии совокупностей не равны, поэтому параметр equal_var указываем equal_var=False. Критический уровень статистической значимости примем за 0,01, так как наша выборка достаточно объемна и следует понизить уровень значимости."""

alpha = .01 
results = st.ttest_ind(genre_action, genre_sports, equal_var=False)
print('p-значение: ', results.pvalue)
if (results.pvalue  < alpha):
    print("Отвергаем нулевую гипотезу")
else:
    print("Не получилось отвергнуть нулевую гипотезу")

"""Полученное значение p-value говорит о том, что, хотя средние пользовательские рейтинги похожи, с вероятностью около 10% такое сходство случайно, и следует принимать, что пользователи по разному оценивают жанры action и sports.

Общий вывод

Массовое развитие игр началось примерно с 1994, а пик продаж пришелся на 2008-2009 год. Затем, из-за развития технологий и популярности мобильных игр и приложений, уровень продаж начал снижаться.

Самые популярные платформы - игровые приставки линейки PlayStation компании Sony( PlayStation, PlayStation 2 и PlayStation 3). Следующие по популярности - консоли от Nintendo DS и Wii, а также игровая приставка компании Microsoft Xbox 360. 

Для всех платформ наблюдается примерно одинаковая картина развития - время существования определенной модели 10-12 лет, на пике популярности держится около 4 лет. Из популярных раньше платформ до 2016 продержались Wii, X360 и PS3.

Самыми популярными в 2016 году стали игры для PS4 и XOne. Поэтому при составлении плана на следующий год следует ориентироваться на эти приставки. Однако, работая на перспективу, возможно, следует поменять политику и частично перейти на игры для компьютеров и мобильных устройств.

Отзывы пользователей очень незначительно влияют на решение других пользователей о покупке. Отзывы критиков у покупателей вызывают больше доверия и значительнее влияют на решение совершить покупку. Поэтому, выбирая игры для последующих закупок магазина, следует опираться на сформулированные критиками списки топ-игр. 

Выше всего критики оценивают sports, причем рейтинг критиков достаточно однороден.

Самый продаваемый жанр - action, затем идут sport и shooter. Racing, misc, platform имеют примерно одинаковую популярность. Самые низкие продажи у игр жанра strategy. 

Для региона Северной Америки и Европы наблюдается примерно одинаковая картина - самые популярные игры для таких платформ, как X360, PS2, Wii, PS3. Самые популярные жанры - action, sports, shooter. Лучше всего продавались игры с рейтингом Е (Everyone, для всех), а также с рейтингом T (Teen, Подросткам 13—19) и M(Mature, от 17 лет). Для Японии предпочтения пользователей отличаются от предпочтений в Америке и Европе. Самые популярные игровые платформы - DS, PS, PS2, SNES, 3DS. Также среди популярных жанров, помимо action и sports, выделяется role-playing. Соответственно, формировать политику компании можно в двух направлениях - объединенный сегмент Северной Америки и Европы и отдельно подбирать игры для азиатского сегмента с учетом региональных особенностей.

В целом, влияние рейтинга на продажи в разных регионах примерно одинаковое. Можно предположить, что средний пользователь игр в Японии младше, чем пользователь в Европе или Северной Америке. 

Пользователи по разному оценивают платформы Xbox One и PC, причем рейтинг у PC выше, что подтверждает уместность ориентироваться на игры для компьютеров. Также пользователи по разному оценивают жанры action и sports, жанр action пользуется большей популярностью.

Таким образом, основное направление развития магазина - особое внимание играм жанра action и sports для приставки PS4, которые отмечают профессиональные критики, а также играм с рейтингами от 13 лет и старше.
"""

